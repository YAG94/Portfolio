<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio — Yasier</title>
  <style>
    :root { --max: 1100px; --pad: 18px; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height:1.45; background:#0b0b0c; color:#f3f3f3; }
    a { color: inherit; text-decoration: none; opacity:.9; }
    header { position: sticky; top:0; backdrop-filter: blur(10px); background: rgba(11,11,12,.72); border-bottom:1px solid rgba(255,255,255,.08); z-index:10;}
    .wrap { max-width: var(--max); margin: 0 auto; padding: 0 var(--pad); }
    .top { display:flex; align-items:center; justify-content:space-between; padding: 14px 0; gap:12px; }
    .name { font-weight:700; letter-spacing:.2px; }
    .nav { display:flex; gap:10px; flex-wrap: wrap; }
    .chip { padding:8px 10px; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:13px; }
    .hero { padding: 34px 0 10px; }
    h1 { font-size: 34px; margin: 0 0 10px; }
    .sub { opacity:.85; max-width: 70ch; }
    .sectionTitle { margin: 28px 0 10px; font-size: 18px; opacity:.9; }
    .project { display:grid; grid-template-columns: 1.05fr .95fr; gap:18px; padding: 18px; margin: 14px 0; border:1px solid rgba(255,255,255,.10); border-radius: 18px; background: rgba(255,255,255,.03); }
    .meta { opacity:.85; font-size: 13px; margin: 6px 0 10px; }
    .bullets { margin: 0; padding-left: 18px; opacity:.95; }
    .tags { display:flex; flex-wrap:wrap; gap:8px; margin-top: 10px; }
    .tag { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10); opacity:.9; }

    /* Carrusel horizontal */
    .carousel { position: relative; }
    .track { display:flex; overflow-x:auto; gap:10px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; padding-bottom: 8px; }
    .track::-webkit-scrollbar { height: 10px; }
    .track::-webkit-scrollbar-thumb { background: rgba(255,255,255,.18); border-radius: 999px; }
    .slide { flex: 0 0 86%; scroll-snap-align: start; border-radius: 14px; overflow:hidden; border:1px solid rgba(255,255,255,.10); background:#111; }
    .slide img { width:100%; height:auto; display:block; }

    /* Controles opcionales (desktop) */
    .controls { display:flex; gap:10px; margin-top: 10px; }
    button { cursor:pointer; border-radius: 12px; padding:10px 12px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color:#fff; }
    button:hover { background: rgba(255,255,255,.10); }

    /* Responsive */
    @media (max-width: 860px) {
      .project { grid-template-columns: 1fr; }
      .slide { flex-basis: 92%; }
      h1 { font-size: 28px; }
    }
    footer { padding: 30px 0 40px; opacity:.85; }
  </style>
</head>
<body>
  <header>
    <div class="wrap top">
      <div class="name">Yasier — Delineante / CAD</div>
      <nav class="nav">
        <a class="chip" href="#corporativa">Imagen corporativa</a>
        <a class="chip" href="#mecanica">Mecánica</a>
        <a class="chip" href="#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Portfolio</h1>
      <p class="sub">Proyectos seleccionados de delineación y CAD (documentación técnica, planos, despiece, ensambles e implantaciones). Optimizado para móvil.</p>
    </section>

    <h2 id="corporativa" class="sectionTitle">Imagen corporativa</h2>

    <!-- MOEVE (1º) -->
    <article class="project">
      <div>
        Proyecto: Implementación de marca — Cepsa → Moeve (implantación / señalética)
        <div class="meta">Rol: Delineante CAD / documentación técnica · Herramientas: AutoCAD</div>
        <ul class="bullets">
          <li>Planos de implantación y documentación técnica para implementación de imagen corporativa</li>
          <li>Detalles de montaje, cotas y especificaciones según manual de marca</li>
          <li>Entregables listos para fabricación e instalación</li>
        </ul>
        <div class="tags">
          <span class="tag">Implantación</span><span class="tag">Señalética</span><span class="tag">Planos 2D</span><span class="tag">Montaje</span>
        </div>
      </div>
      <div class="carousel" data-images='[
        "img/moeve_01/01.webp",
        "img/moeve_01/02.webp",
        "img/moeve_01/03.webp",
        "img/moeve_01/04.webp",
        "img/moeve_01/05.webp",
        "img/moeve_01/06.webp",
        "img/moeve_01/07.webp",
        "img/moeve_01/08.webp",
        "img/moeve_01/09.webp"
      ]'></div>
    </article>

    <!-- CAIXABANK / AGROBANK (2º) -->
    <article class="project">
      <div>
        <h3 style="margin:0">Proyecto: Rebranding de oficinas — CaixaBank → AgroBank</h3>
        <div class="meta">Rol: Delineante CAD / documentación técnica · Herramientas: AutoCAD</div>
        <ul class="bullets">
          <li>Planos de implantación y señalética para cambio de imagen y adaptación a AgroBank</li>
          <li>Detalles de montaje, cotas y especificaciones según manual corporativo</li>
          <li>Documentación lista para fabricación/instalación</li>
        </ul>
        <div class="tags">
          <span class="tag">Rebranding</span><span class="tag">Señalética</span><span class="tag">Planos 2D</span><span class="tag">Implantación</span>
        </div>
      </div>
      <div class="carousel" data-images='[
        "img/caixabank_agrobank_01/01.webp"
      ]'></div>
    </article>

    <!-- TOYOTA (3º) -->
    <article class="project">
      <div>
        <h3 style="margin:0">Proyecto: Actualización imagen — Toyota (concesionario / señalética)</h3>
        <div class="meta">Rol: Delineante CAD / documentación técnica · Herramientas: AutoCAD</div>
        <ul class="bullets">
          <li>Documentación gráfica y planos para implementación de imagen en punto de venta</li>
          <li>Detalles de montaje, cotas y coordinación con equipos técnicos</li>
          <li>Entregables listos para fabricación e instalación</li>
        </ul>
        <div class="tags">
          <span class="tag">Retail</span><span class="tag">Señalética</span><span class="tag">Planos 2D</span><span class="tag">Montaje</span>
        </div>
      </div>
      <div class="carousel" data-images='[
        "img/toyota_01/01.webp"
      ]'></div>
    </article>

    <h2 id="contacto" class="sectionTitle">Contacto</h2>
    <footer>
      <div>Email: tu@email.com · Tel/WhatsApp: +34 XXX XXX XXX</div>
      <div style="margin-top:8px">Alcalá de Henares · Madrid</div>
    </footer>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

  // ======================
  // 1) Lightbox: crea HTML+CSS si no existen
  // ======================
  let lb = document.getElementById('lightbox');

  if (!document.getElementById('lb-style')) {
    const st = document.createElement('style');
    st.id = 'lb-style';
    st.textContent = `
      .lb{
        position:fixed; inset:0; display:none; z-index:9999;
        background:rgba(0,0,0,.86);
        align-items:center; justify-content:center; padding:16px;
        overscroll-behavior:contain;
        touch-action:none;
      }
      .lb.open{ display:flex; }
      .lbImg{
        max-width:min(96vw,1200px);
        max-height:88vh;
        border-radius:14px;
        background:#111;
        box-shadow:0 10px 30px rgba(0,0,0,.45);
        transform: translate3d(0,0,0) scale(1);
        transform-origin:center center;
        will-change: transform;
      }
      .lbClose,.lbPrev,.lbNext{
        position:absolute;
        border:1px solid rgba(255,255,255,.14);
        background:rgba(255,255,255,.08);
        color:#fff;
        width:44px; height:44px;
        border-radius:12px;
        cursor:pointer;
        user-select:none;
      }
      .lbClose{ top:14px; right:14px; font-size:28px; line-height:1; }
      .lbPrev{ left:14px; font-size:28px; }
      .lbNext{ right:14px; font-size:28px; }
      .lbCounter{ position:absolute; bottom:14px; color:rgba(255,255,255,.85); font-size:13px; }
      .slide img{ cursor: zoom-in; }
    `;
    document.head.appendChild(st);
  }

  if (!lb) {
    lb = document.createElement('div');
    lb.id = 'lightbox';
    lb.className = 'lb';
    lb.setAttribute('aria-hidden', 'true');
    lb.innerHTML = `
      <button class="lbClose" type="button" aria-label="Cerrar">×</button>
      <button class="lbPrev" type="button" aria-label="Anterior">‹</button>
      <img class="lbImg" alt="Vista ampliada">
      <button class="lbNext" type="button" aria-label="Siguiente">›</button>
      <div class="lbCounter"></div>
    `;
    document.body.appendChild(lb);
  }

  const lbImg = lb.querySelector('.lbImg');
  const lbClose = lb.querySelector('.lbClose');
  const lbPrev = lb.querySelector('.lbPrev');
  const lbNext = lb.querySelector('.lbNext');
  const lbCounter = lb.querySelector('.lbCounter');

  // ======================
  // 2) Bloqueo de scroll del fondo (iOS friendly)
  // ======================
  let savedScrollY = 0;
  function lockBodyScroll() {
    savedScrollY = window.scrollY || document.documentElement.scrollTop || 0;
    document.body.style.position = 'fixed';
    document.body.style.top = `-${savedScrollY}px`;
    document.body.style.left = '0';
    document.body.style.right = '0';
    document.body.style.width = '100%';
  }
  function unlockBodyScroll() {
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.left = '';
    document.body.style.right = '';
    document.body.style.width = '';
    window.scrollTo(0, savedScrollY);
  }

  // ======================
  // 3) Estado del visor
  // ======================
  let currentImages = [];
  let currentIndex = 0;

  // Zoom/Pan
  let scale = 1, tx = 0, ty = 0;
  let baseW = 0, baseH = 0;

  // IMPORTANTE: para NO resetear zoom al cargar
  let userInteracted = false;

  function measureBaseSize() {
    baseW = lbImg.offsetWidth || lbImg.getBoundingClientRect().width || 0;
    baseH = lbImg.offsetHeight || lbImg.getBoundingClientRect().height || 0;
  }

  function maxPanX() { return Math.max(0, (baseW * (scale - 1)) / 2); }
  function maxPanY() { return Math.max(0, (baseH * (scale - 1)) / 2); }

  function clampPan() {
    tx = clamp(tx, -maxPanX(), maxPanX());
    ty = clamp(ty, -maxPanY(), maxPanY());
  }

  function applyTransform() {
    lbImg.style.transform = `translate3d(${tx}px, ${ty}px, 0) scale(${scale})`;
  }

  function resetZoom() {
    scale = 1; tx = 0; ty = 0;
    applyTransform();
  }

  function showLB() {
    userInteracted = false;
    lbCounter.textContent = `${currentIndex + 1} / ${currentImages.length}`;

    lbImg.onload = () => {
      measureBaseSize();
      if (!userInteracted) {
        resetZoom();
      } else {
        clampPan();
        applyTransform();
      }
    };

    requestAnimationFrame(() => {
      measureBaseSize();
      clampPan();
      applyTransform();
    });

    lbImg.src = currentImages[currentIndex];
  }

  function openLB(images, idx) {
    currentImages = images;
    currentIndex = idx;

    lb.classList.add('open');
    lb.setAttribute('aria-hidden', 'false');
    lockBodyScroll();

    showLB();
  }

  function closeLB() {
    lb.classList.remove('open');
    lb.setAttribute('aria-hidden', 'true');
    lbImg.src = '';
    resetZoom();
    unlockBodyScroll();
  }

  function prevLB() {
    currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
    showLB();
  }

  function nextLB() {
    currentIndex = (currentIndex + 1) % currentImages.length;
    showLB();
  }

  lbClose.addEventListener('click', closeLB);
  lbPrev.addEventListener('click', prevLB);
  lbNext.addEventListener('click', nextLB);

  // Fix móvil: botones
  lbClose.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); closeLB(); }, { passive: false });
  lbPrev.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); prevLB(); }, { passive: false });
  lbNext.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); nextLB(); }, { passive: false });

  // ======================
  // ✅ RESET AL GIRAR / RESIZE (lo que pediste)
  // ======================
  function resetViewOnRotate() {
    if (!lb.classList.contains('open')) return;
    userInteracted = false;
    resetZoom();

    // Espera a que el layout se estabilice tras girar
    requestAnimationFrame(() => {
      measureBaseSize();
      resetZoom();
      requestAnimationFrame(() => {
        measureBaseSize();
        resetZoom();
      });
    });
  }

  let rotateTimer = null;
  function scheduleResetView() {
    clearTimeout(rotateTimer);
    rotateTimer = setTimeout(resetViewOnRotate, 120);
  }

  window.addEventListener('orientationchange', scheduleResetView);
  window.addEventListener('resize', scheduleResetView);

  // ======================
  // 4) Gestos: pinch zoom + pan + swipe solo en borde cuando hay zoom
  // ======================
  let mode = 'none';
  let startX = 0, startY = 0, startTx = 0, startTy = 0;
  let lastDx = 0, lastDy = 0;

  let pinchStartDist = 0;
  let pinchStartScale = 1;

  let edgeSwipeX = 0;
  const EDGE_SWIPE_THRESHOLD = 70;

  function dist2(t1, t2) {
    const dx = t2.clientX - t1.clientX;
    const dy = t2.clientY - t1.clientY;
    return Math.hypot(dx, dy);
  }

  lb.addEventListener('touchstart', (e) => {
    if (!lb.classList.contains('open')) return;

    // no bloquear los botones
    if (e.target.closest('.lbClose, .lbPrev, .lbNext')) return;

    e.preventDefault();
    userInteracted = true;

    if (e.touches.length === 2) {
      mode = 'pinch';
      pinchStartDist = dist2(e.touches[0], e.touches[1]);
      pinchStartScale = scale;
      edgeSwipeX = 0;
      return;
    }

    if (e.touches.length === 1) {
      mode = (scale > 1) ? 'pan' : 'swipe';
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      startTx = tx;
      startTy = ty;
      lastDx = 0;
      lastDy = 0;
      edgeSwipeX = 0;
    }
  }, { passive: false });

  lb.addEventListener('touchmove', (e) => {
    if (!lb.classList.contains('open')) return;

    if (e.target.closest('.lbClose, .lbPrev, .lbNext')) return;

    e.preventDefault();
    userInteracted = true;

    if (mode === 'pinch' && e.touches.length === 2) {
      const d = dist2(e.touches[0], e.touches[1]);
      const factor = d / (pinchStartDist || d);
      scale = clamp(pinchStartScale * factor, 1, 4);
      clampPan();
      applyTransform();
      return;
    }

    if (e.touches.length === 1) {
      const x = e.touches[0].clientX;
      const y = e.touches[0].clientY;
      const dx = x - startX;
      const dy = y - startY;
      lastDx = dx;
      lastDy = dy;

      if (scale > 1) {
        const mx = maxPanX();
        const my = maxPanY();

        const proposedTx = startTx + dx;
        const proposedTy = startTy + dy;

        const clampedTx = clamp(proposedTx, -mx, mx);
        const clampedTy = clamp(proposedTy, -my, my);

        const hitXEdge = (clampedTx !== proposedTx) && (Math.abs(dx) > Math.abs(dy));

        tx = clampedTx;
        ty = clampedTy;
        applyTransform();

        if (hitXEdge) edgeSwipeX += dx;
        else edgeSwipeX = 0;

        return;
      }
    }
  }, { passive: false });

  lb.addEventListener('touchend', () => {
    if (!lb.classList.contains('open')) return;

    if (scale > 1) {
      if (Math.abs(edgeSwipeX) > EDGE_SWIPE_THRESHOLD) {
        if (edgeSwipeX > 0) prevLB();
        else nextLB();
      }
      edgeSwipeX = 0;
      mode = 'none';
      return;
    }

    if (Math.abs(lastDx) > 45 && Math.abs(lastDx) > Math.abs(lastDy)) {
      if (lastDx > 0) prevLB();
      else nextLB();
    }

    mode = 'none';
  }, { passive: false });

  // ======================
  // 5) Render carruseles
  // ======================
  document.querySelectorAll('.carousel').forEach((c) => {
    if (c.querySelector('.track')) return;

    let imgs = [];
    try { imgs = JSON.parse(c.getAttribute('data-images') || '[]'); } catch { imgs = []; }
    if (!imgs.length) return;

    const track = document.createElement('div');
    track.className = 'track';

    imgs.forEach((src, idx) => {
      const slide = document.createElement('div');
      slide.className = 'slide';

      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.src = src;
      img.alt = '';

      img.addEventListener('click', () => openLB(imgs, idx));

      slide.appendChild(img);
      track.appendChild(slide);
    });

    c.appendChild(track);

    const controls = document.createElement('div');
    controls.className = 'controls';
    const prev = document.createElement('button');
    prev.textContent = '←';
    const next = document.createElement('button');
    next.textContent = '→';

    const scrollBy = () => Math.min(track.clientWidth * 0.9, 900);
    prev.onclick = () => track.scrollBy({ left: -scrollBy(), behavior: 'smooth' });
    next.onclick = () => track.scrollBy({ left:  scrollBy(), behavior: 'smooth' });

    controls.appendChild(prev);
    controls.appendChild(next);
    c.appendChild(controls);
  });
});
</script>

</body>
</html>
